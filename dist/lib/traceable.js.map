{"version":3,"sources":["traceable.js"],"names":["Object","defineProperty","exports","value","traceable","arg","key","dtor","_traceable","flag","name","target","wrap","fn","callback","gn","__traced__","undefined","constructor","tn","args","global","TRACE","_console","CONSOLE","console","t0","Date","result","apply","dt","setTimeout","group","length","debug","groupEnd","el","hasOwnProperty","get","set"],"mappings":"AAAA;AACA;;AACA;;AACA;;AACA;;AACA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,SAASC,SAAT,CAAmBC,GAAnB,EAAwBC,GAAxB,EAA6BC,IAA7B,EAAmC;AAC/B,MAAI,OAAOF,GAAP,KAAe,SAAnB,EAA8B;AAC1B,WAAOG,UAAU,CAACH,GAAD,CAAjB;AACH,GAFD,MAGK;AACDG,IAAAA,UAAU,CAAC,IAAD,CAAV,CAAiBH,GAAjB,EAAsBC,GAAtB,EAA2BC,IAA3B;AACH;AACJ;;AACDL,OAAO,CAACE,SAAR,GAAoBA,SAApB;;AACA,SAASI,UAAT,CAAoBC,IAApB,EAA0BC,IAA1B,EAAgC;AAC5B,SAAO,UAAUC,MAAV,EAAkBL,GAAlB,EAAuBC,IAAvB,EAA6B;AAChC,QAAMK,IAAI,GAAG,SAAPA,IAAO,CAACC,EAAD,EAAKC,QAAL,EAAkB;AAC3B,UAAMC,EAAE,GAAGF,EAAX;;AACA,UAAI,CAACJ,IAAL,EAAW;AACPM,QAAAA,EAAE,CAACC,UAAH,GAAgB,IAAhB;AACH,OAFD,MAGK;AACD,YAAID,EAAE,CAACC,UAAH,KAAkBC,SAAtB,EAAiC;AAC7B,cAAIP,IAAI,KAAKO,SAAb,EAAwB;AACpBF,YAAAA,EAAE,CAACC,UAAH,GAAgBN,IAAhB;AACH,WAFD,MAGK;AACD,gBAAIC,MAAM,CAACO,WAAP,IACAP,MAAM,CAACO,WAAP,CAAmBR,IAAnB,KAA4BO,SADhC,EAC2C;AACvCF,cAAAA,EAAE,CAACC,UAAH,GAAgBL,MAAM,CAACO,WAAP,CAAmBR,IAAnC;AACH,aAHD,MAIK,IAAIC,MAAM,CAACD,IAAP,KAAgBO,SAApB,EAA+B;AAChCF,cAAAA,EAAE,CAACC,UAAH,GAAgBL,MAAM,CAACD,IAAvB;AACH,aAFI,MAGA;AACDK,cAAAA,EAAE,CAACC,UAAH,GAAgB,GAAhB;AACH;AACJ;;AACD,cAAMG,EAAE,GAAG,SAALA,EAAK,GAAmB;AAAA,8CAANC,IAAM;AAANA,cAAAA,IAAM;AAAA;;AAC1B,gBAAIC,MAAM,CAACC,KAAX,EAAkB;AACd,kBAAMC,QAAQ,GAAGF,MAAM,CAACG,OAAP,GACXH,MAAM,CAACG,OADI,GAEXC,OAFN;;AAGA,kBAAMC,EAAE,GAAG,IAAIC,IAAJ,EAAX;AACA,kBAAMC,MAAM,GAAGb,EAAE,CAACc,KAAH,CAAS,IAAT,EAAeT,IAAf,CAAf;AACA,kBAAMU,EAAE,GAAG,IAAIH,IAAJ,KAAaD,EAAxB;AACAK,cAAAA,UAAU,CAAC,YAAM;AACbR,gBAAAA,QAAQ,CAACS,KAAT,WAAkBjB,EAAE,CAACC,UAArB,cAAmCV,GAAnC,GAA0C,GAA1C,EAA+CwB,EAA/C,EAAmD,IAAnD,EAAyD,GAAzD;;AACA,oBAAIV,IAAI,CAACa,MAAL,GAAc,CAAlB,EAAqB;AACjBV,kBAAAA,QAAQ,CAACW,KAAT,OAAAX,QAAQ,EAAUH,IAAV,CAAR;AACH;;AACD,oBAAIQ,MAAM,KAAKX,SAAf,EAA0B;AACtBM,kBAAAA,QAAQ,CAACW,KAAT,CAAeN,MAAf;AACH;;AACDL,gBAAAA,QAAQ,CAACY,QAAT;AACH,eATS,EASPd,MAAM,CAACC,KAAP,IAAgB,CATT,CAAV;AAUA,qBAAOM,MAAP;AACH,aAlBD,MAmBK;AACD,qBAAOb,EAAE,CAACc,KAAH,CAAS,IAAT,EAAeT,IAAf,CAAP;AACH;AACJ,WAvBD;;AAwBA,eAAK,IAAMgB,EAAX,IAAiBrB,EAAjB,EAAqB;AACjB,gBAAIA,EAAE,CAACsB,cAAH,CAAkBD,EAAlB,CAAJ,EAA2B;AACvBjB,cAAAA,EAAE,CAACiB,EAAD,CAAF,GAASrB,EAAE,CAACqB,EAAD,CAAX;AACH;AACJ;;AACDtB,UAAAA,QAAQ,CAACK,EAAD,CAAR;AACH;AACJ;AACJ,KAtDD;;AAuDA,QAAIZ,IAAJ,EAAU;AACN,UAAI,OAAOA,IAAI,CAACJ,KAAZ,KAAsB,UAA1B,EAAsC;AAClCS,QAAAA,IAAI,CAACL,IAAI,CAACJ,KAAN,EAAa,UAACgB,EAAD,EAAQ;AACrBZ,UAAAA,IAAI,CAACJ,KAAL,GAAagB,EAAb;AACH,SAFG,CAAJ;AAGH,OAJD,MAKK;AACD,YAAI,OAAOZ,IAAI,CAAC+B,GAAZ,KAAoB,UAAxB,EAAoC;AAChC1B,UAAAA,IAAI,CAACL,IAAI,CAAC+B,GAAN,EAAW,UAACnB,EAAD,EAAQ;AACnBZ,YAAAA,IAAI,CAAC+B,GAAL,GAAWnB,EAAX;AACH,WAFG,CAAJ;AAGH;;AACD,YAAI,OAAOZ,IAAI,CAACgC,GAAZ,KAAoB,UAAxB,EAAoC;AAChC3B,UAAAA,IAAI,CAACL,IAAI,CAACgC,GAAN,EAAW,UAACpB,EAAD,EAAQ;AACnBZ,YAAAA,IAAI,CAACgC,GAAL,GAAWpB,EAAX;AACH,WAFG,CAAJ;AAGH;AACJ;AACJ,KAlBD,MAmBK;AACDP,MAAAA,IAAI,CAACD,MAAM,CAACL,GAAD,CAAP,EAAc,UAACa,EAAD,EAAQ;AACtBR,QAAAA,MAAM,CAACL,GAAD,CAAN,GAAca,EAAd;AACH,OAFG,CAAJ;AAGH;AACJ,GAhFD;AAiFH;;AACDjB,OAAO,CAACM,UAAR,GAAqBA,UAArB;AACAN,OAAO,WAAP,GAAkBE,SAAlB","sourcesContent":["\"use strict\";\n/* tslint:disable:ban-types */\n/* tslint:disable:no-string-literal */\n/* tslint:disable:only-arrow-functions */\n/* tslint:disable:trailing-comma */\n/* tslint:disable:variable-name */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction traceable(arg, key, dtor) {\n    if (typeof arg === \"boolean\") {\n        return _traceable(arg);\n    }\n    else {\n        _traceable(true)(arg, key, dtor);\n    }\n}\nexports.traceable = traceable;\nfunction _traceable(flag, name) {\n    return function (target, key, dtor) {\n        const wrap = (fn, callback) => {\n            const gn = fn;\n            if (!flag) {\n                gn.__traced__ = null;\n            }\n            else {\n                if (gn.__traced__ === undefined) {\n                    if (name !== undefined) {\n                        gn.__traced__ = name;\n                    }\n                    else {\n                        if (target.constructor &&\n                            target.constructor.name !== undefined) {\n                            gn.__traced__ = target.constructor.name;\n                        }\n                        else if (target.name !== undefined) {\n                            gn.__traced__ = target.name;\n                        }\n                        else {\n                            gn.__traced__ = \"@\";\n                        }\n                    }\n                    const tn = function (...args) {\n                        if (global.TRACE) {\n                            const _console = global.CONSOLE\n                                ? global.CONSOLE\n                                : console;\n                            const t0 = new Date();\n                            const result = gn.apply(this, args);\n                            const dt = new Date() - t0;\n                            setTimeout(() => {\n                                _console.group(`${gn.__traced__}.${key}`, \"[\", dt, \"ms\", \"]\");\n                                if (args.length > 0) {\n                                    _console.debug(...args);\n                                }\n                                if (result !== undefined) {\n                                    _console.debug(result);\n                                }\n                                _console.groupEnd();\n                            }, global.TRACE || 0);\n                            return result;\n                        }\n                        else {\n                            return gn.apply(this, args);\n                        }\n                    };\n                    for (const el in gn) {\n                        if (gn.hasOwnProperty(el)) {\n                            tn[el] = gn[el];\n                        }\n                    }\n                    callback(tn);\n                }\n            }\n        };\n        if (dtor) {\n            if (typeof dtor.value === \"function\") {\n                wrap(dtor.value, (tn) => {\n                    dtor.value = tn;\n                });\n            }\n            else {\n                if (typeof dtor.get === \"function\") {\n                    wrap(dtor.get, (tn) => {\n                        dtor.get = tn;\n                    });\n                }\n                if (typeof dtor.set === \"function\") {\n                    wrap(dtor.set, (tn) => {\n                        dtor.set = tn;\n                    });\n                }\n            }\n        }\n        else {\n            wrap(target[key], (tn) => {\n                target[key] = tn;\n            });\n        }\n    };\n}\nexports._traceable = _traceable;\nexports.default = traceable;\n"],"file":"traceable.js"}